<!doctype html>
<html>
<head>
  <title>SSH Client</title>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script type="application/javascript" src="http://ipinfo.io/?format=jsonp&callback=getIP"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }

    .terminal {
      font-family: monospace;
      color: white;
      background: black;
    }
  </style>
</head>

<body>
  <h1>SSH</h1>

  <div class="terminal">
  <!--<ul id="messages"></ul>
  <form action="">
    <input id="m" autocomplete="off" /><button>Send</button>
  </form>-->

  </div>
  <script>
  // Connect to the socket.io server
  //var socket = io.connect('http://ws-control.machinesense.com:8080/');

  var socket = io();
  var id = "web";
  socket.on('connect', function(){
    console.log('socket Connected');
    socket.emit('register', id);
    socket.on('register', (msg) => {
      if(msg == 'successful'){
        let termMsg = {
          to : 'ssh',
          from : id,
          body : 'start'
        };
        socket.emit('term', JSON.stringify(termMsg));
      }
    })
  });
  //socket.on('event', function(data){});
  socket.on('disconnect', function(){
    console.log('socket disconnected');

  });

  // Wait for data from the server
  socket.on('output', function (data) {
    // Insert some line breaks where they belong
      data = data.replace("\n", "<br>");
      data = data.replace("\r", "<br>");
      // Append the data to our terminal
      $('.terminal').append(data);
  });

  $(function () {
    //var socket = io();
    $('form').submit(function(e) {
      e.preventDefault(); // prevents page reloading
      var data = {};
      data.from = "temp";
      data.to = "temp"
      data.body = $('#m').val();
      socket.emit('input', JSON.stringify(data));
      $('#m').val('');
      return false;
    });
    socket.on('input', function(msg){
      console.log('input', msg);
    })
    socket.on('output', function(msg){
      $('#messages').append($('<li>').text(JSON.parse(msg).body));
    });
  });

  // Listen for user input and pass it to the server
  $(document).on("keypress",function(e){
    var char = "";
    char = String.fromCharCode(e.which);

    socket.emit("input", char);
  });

  </script>
</body>
</html>
